[safe_mysqld]
err-log = <%= @params[:config][:mysqld_error_log] %>

[mysqld]
datadir = <%= @params[:config][:datadir] %>
socket = <%= @params[:config][:socket_path] %>
log-slow-queries = <%= @params[:config][:slow_query_log] %>
log-error = <%= @params[:config][:mysqld_error_log] %>
pid-file = <%= @params[:config][:pidfile] %>
server-id = <%= @params[:config][:server_id] %>
report-host = <%= @node[:hostname] %>
port = <%= @params[:config][:port] %>
<% if @params[:config][:binlogs_enabled] -%>
log-bin = <%= @params[:config][:binlog_dir] %>
binlog-ignore-db = mysql
sync_binlog = 1
<% end -%>
innodb_data_home_dir = <%= @params[:config][:datadir] %>
<% if @params[:config][:innodb_file_per_table] -%>
innodb_file_per_table
<% end -%>
innodb_data_file_path = ibdata1:10M:autoextend
innodb_log_group_home_dir = <%= @params[:config][:innodb_log_dir] %>
innodb_log_arch_dir = <%= @params[:config][:innodb_log_dir] %>
innodb_log_files_in_group = 2
innodb_log_file_size = 200M
innodb_log_buffer_size = 8M
innodb_flush_log_at_trx_commit = 1
innodb_flush_method = O_DIRECT
max_connections = 300
thread_cache = 64
table_cache = 1024
log-warnings
key_buffer = 16M
long_query_time = 2000000
max_allowed_packet = 16M
query_cache_size = 100M
max_connect_errors = 99999999
skip-locking
innodb_buffer_pool_size = <%= @params[:config][:innodb_buffer_pool_size] %>
innodb_thread_concurrency = 4
<% if @node[:mysql][:percona_patches] %>
log_slow_verbosity = "query_plan,innodb"
<% end %>

<% if @params[:backup_location] -%>
[xtrabackup]
target_dir = <%= @params[:backup_location] %>
<% end -%>
