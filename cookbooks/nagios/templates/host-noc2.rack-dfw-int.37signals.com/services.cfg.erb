define service {
  use default-service
  host_name *
  service_description ping
  check_command check_ping!50.0,20%!150.0,30%
}

define service {
  use                     default-service
  hostgroup_name          servers, linux_boxes, freebsd_boxes, slices
  service_description     Free Space All Disks
  check_command			      check_all_disks
}

define service {
	use                     default-service
	hostgroup_name          servers
	host_name               !<%= @node[:fqdn] %>
	service_description     Load Average
	check_command			      check_load
}

define service{
  use                     default-service
  hostgroup_name          servers
  service_description     Free Memory
  check_command			      check_mem
}


# application checks

# old services


define hostgroup{
	hostgroup_name netapp
	alias netapp
}

define hostgroup{
	hostgroup_name slices
	alias slices
}

define hostgroup{
	hostgroup_name linux_boxes
	alias linux_boxes
}

define hostgroup{
	hostgroup_name freebsd_boxes
	alias freebsd_boxes
}

define hostgroup {
	hostgroup_name bc_solr
	alias bc_solr
}

define hostgroup {
	hostgroup_name passive_boxes
	alias passive_boxes
}

define hostgroup {
	hostgroup_name cf_solr
	alias cf_solr
}

define hostgroup {
	hostgroup_name hr_solr
	alias hr_solr
}

define hostgroup {
	hostgroup_name decomm
	alias decomm
}

define hostgroup {
	hostgroup_name db_master
	alias db_master
}

define hostgroup {
	hostgroup_name db_slave
	alias db_slave
}

define hostgroup{
	hostgroup_name bc-web
	alias bc-web
}
define hostgroup{
	hostgroup_name hr-web
	alias hr-web
}

#define hostgroup {
#	hostgroup_name wb-app
#	alias Writeboard App
#}

define hostgroup {
	hostgroup_name bp-app
	alias Backpack App 
} 

define hostgroup {
	hostgroup_name bc-app
	alias Basecamp App
}

define hostgroup {
	hostgroup_name cf-app
	alias Campfire App
}

define hostgroup {
	hostgroup_name hr-app
	alias Highrise App
}

define hostgroup {
	hostgroup_name live-app
	alias 37s Live App
}

define hostgroup {
	hostgroup_name web-general
	alias Small Apps and Sites
}

define hostgroup {
	hostgroup_name app-general
	alias Small Apps and Sites
}

define service{
    use                     generic-service
    hostgroup_name          db_master, db_slave
    service_description     DB Free Memory
		check_command			check_mem
}

define serviceescalation{
	hostgroup_name		db_master, db_slave
	service_description	DB Free Memory
	first_notification	3
	last_notification	5
	notification_interval	600
	contact_groups		sysadmin-sms
	}

define service{
	use                     notify-on-critical
	hostgroup_name          slices, linux_boxes, freebsd_boxes
	service_description     Load Average
	check_command			check_load
}

define service {
		use generic-service
		host_name netapp-01
		service_description	NetApp 1 Xen Used Space
		check_command			check_netapp!90!95!/vol/xen/
}

define service {
		use generic-service
		host_name netapp-02
		service_description	NetApp 2 Xen Used Space
		check_command			check_netapp!80!85!/vol/xen2/
}

define service {
		use generic-service
		host_name netapp-02
		service_description	NetApp 2 Backups Used Space
		check_command			check_netapp!80!85!/vol/backup/
}


define service {
		use generic-service
		host_name bc-db-02
		service_description		Files Pending Purge
		check_command			check_query_count!basecamp_ro!oDhdFrgvB2!basecamp_production!"select count(*) from pending_purges"!150000!175000
}

define service {
		use generic-service
		host_name bc-db-02
		service_description		Files Pending Migration
		check_command			check_query_count!basecamp_ro!oDhdFrgvB2!basecamp_production!"select count(*) from attachments where migrated is null and hosted = 1 and byte_size < 100000000"!80000!90000
}

# define service{
#         use                     generic-service
#         hostgroup_name               db_slave
#         service_description    	MySQL Replication
# 		check_command			check_replication
# }

define service{
        use                     generic-service
		hostgroup_name			bc_solr
        service_description     BC Solr
		check_command			check_solr!basecamp
}

define service{
        use                     generic-service
		hostgroup_name			cf_solr
        service_description     CF Solr
		check_command			check_solr!campfire
}

define service{
    use                     generic-service
		hostgroup_name               hr_solr
    service_description     HR Solr
		max_check_attempts			6
		check_command	query_solr!highrise!%2Bmodel_base_class%3ARecording+AND+%2B%28name_string%3A%22test%22%5E4+OR+body_text%3A%22test%22%5E3+OR+name_string%3A%28test%29%5E1.5+OR+body_text%3A%28test%29%29%3B+created_at_datetime+desc%3B
}

define service{
        use                     generic-service
		host_name				search1
        service_description     BP Solr
		check_command			check_solr!backpack
}

define service {
		use generic-service
		host_name mail-01,mail-02
		service_description	BC Incoming mail queue
		check_command			check_file_count!/u/depot/basecamp/email/incoming/new!200!250
}

define service {
		use generic-service
		host_name ob-app-01,ob-app-02
		service_description	OB Memcached
		check_command			check_tcp!11211
}

define service {
		use frequent-service
		hostgroup_name live-app
		service_description	37sLive HTTP content
		check_command			check_http_content!live.37signals.com!/!Live
}

define service {
  use                 frequent-service-with-sms
  host_name	    cf-poll-01,cf-poll-02,cf-poll-03
  service_description Campfire Poller
  check_command       check_campfire_poller
}

#define service {
#		use frequent-service
#		hostgroup_name wb-app
#		service_description	WB HTTP content
#		check_command			check_http_content!123.writeboard.com!/find!/p/list
#}

define service {
		use frequent-service
		hostgroup_name hr-web
		service_description	HR HTTP content
		check_command			check_http_content!37s.highrisehq.com!/login!/session
}

define service {
		use frequent-service
		hostgroup_name bc-web
		host_name bc-app-09,bc-app-10,bc-app-11,bc-app-12
		service_description	BC HTTP content
		check_command			check_http_content!projects.clientsection.com!/login!/login/authenticate
}

define service {
		use frequent-service
		hostgroup_name cf-app
		service_description	CF HTTP content
		check_command			check_http_content!37s.campfirenow.com!/login!/login
}

define service {
		use frequent-service
		host_name	billing
		service_description	QB HTTP content
		check_command			check_http_content!billing.37signals.com!/session/new!/session
}

define service {
		use frequent-service
		hostgroup_name web-general
		service_description	Jobs HTTP content
		check_command			check_http_content!jobs.37signals.com!/!/jobs/search
}

define service {
		use frequent-service
		hostgroup_name web-general
		service_description	Tadalist HTTP content
		check_command			check_http_content!tadalist.com!/!Ta-da
}

define service {
		use frequent-service
		hostgroup_name web-general
		service_description	Backpackit HTTP content
		check_command			check_http_content!backpackit.com!/!Backpack
}

define service {
		use frequent-service
		hostgroup_name web-general
		service_description	Writeboard HTTP content
		check_command			check_http_content!writeboard!/!Writeboard
}

define service {
		use frequent-service
		hostgroup_name web-general
		service_description	Extra Extra JS HTTP content
		check_command			check_http_content!news.37signals.com!/feeds/highrise.js!document.write
}

#define service {
#		use frequent-service
#		hostgroup_name app-general
#		service_description	SvN HTTP content
#		check_command			check_http_content!www.37signals.com!/svn/!simplicity
#}
#
#define service {
#		use frequent-service
#		hostgroup_name app-general
#		service_description	37signals.com HTTP content
#		check_command			check_http_content!www.37signals.com!/!37signals
#}
#
#define service {
#		use frequent-service
#		hostgroup_name app-general
#		service_description	highrisehq HTTP content
#		check_command			check_http_content!highrisehq.com!/!Highrise
#}
#
#define service {
#		use frequent-service
#		hostgroup_name app-general
#		service_description campfirenow HTTP content
#		check_command			check_http_content!campfirenow.com!/!Campfire
#}
#
#define service {
#		use frequent-service
#		hostgroup_name app-general
#		service_description basecamphq HTTP content
#		check_command			check_http_content!basecamphq.com!/!Basecamp
#}


define service {
		use default-service
		host_name localhost
		service_description	CF HAProxy FD errors
		check_command			check_local_log!/u/logs/campfire/haproxy.log!ulimit
}

define service {
		use generic-service
		hostgroup_name cf-app
		service_description	CF proxy errors
		check_command			check_log!/u/apps/campfire/current/log/apache.log!proxy
}

define service {
    use                generic-service
    host_name          cc1,cc2
    service_description   Free Disk Space
		active_checks_enabled 0
		check_freshness 1
		passive_checks_enabled	1
		freshness_threshold 300
		check_command no-disk-checks
}

define service {
    use                generic-service
    host_name          cc1,cc2
    service_description   Free Memory
		active_checks_enabled 0
		check_freshness 1
		passive_checks_enabled	1
		freshness_threshold 300
		check_command no-mem-checks
}

define service {
	use generic-service
	host_name db-slave
	service_description HR Replication
	check_command check_mysqlrep!3306!XLDcjtQVWt!20!100
}

define service {
	use generic-service
	host_name db-slave
	service_description Jobs Replication
	check_command check_mysqlrep!3308!XLDcjtQVWt!20!100
}

define service {
	use generic-service
	host_name db-slave
	service_description BP Replication
	check_command check_mysqlrep!3307!XLDcjtQVWt!20!100
}

define service {
	use generic-service
	host_name db-slave
	service_description CF Replication
	check_command check_mysqlrep!3312!XLDcjtQVWt!20!100
}

define service {
	use generic-service
	host_name db-slave
	service_description WB Replication
	check_command check_mysqlrep!3310!XLDcjtQVWt!250!500
}

define service {
	use generic-service
	host_name db-slave
	service_description OB Replication
	check_command check_mysqlrep!3313!XLDcjtQVWt!20!100
}

define service {
	use generic-service
	host_name db-slave
  	service_description Junta Replication
	check_command check_mysqlrep!3311!XLDcjtQVWt!20!100
}

define service {
	use generic-service
	host_name db-slave
	service_description Extra Extra Replication
	check_command check_mysqlrep!3309!XLDcjtQVWt!20!100
}

define service {
	use generic-service
	host_name bc-db-02
  service_description BC Replication
	check_command check_mysqlrep!3306!XLDcjtQVWt!800!1000
}

define service {
	use default-service
	host_name *, !netapp-01, !netapp-02, !cc1, !cc2, !search1, !db-slave, !billing
	service_description Postfix port 25
	check_command check_smtp
}

define service {
	use generic-service
	host_name bc-solr-01
  service_description BC Solr Index
	check_command check_solr_index!bc
}

define service {
	use generic-service
	host_name hr-solr-01
  service_description HR Solr Index
	check_command check_solr_index!hr
}

define service {
	use generic-service
	host_name cf-solr-01
  service_description CF Solr Index
	check_command check_solr_index!cf
}
